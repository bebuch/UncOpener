find_package(Qt6 REQUIRED COMPONENTS Test Svg Widgets)

add_executable(uncopener_tests
    ConfigTests.cpp
    TestMain.cpp
    PathOpenerTests.cpp
    PlaceholderTests.cpp
    SchemeRegistryTests.cpp
    SecurityPolicyTests.cpp
    UrlContractTests.cpp
)

target_link_libraries(uncopener_tests PRIVATE
    uncopener_core
    Qt6::Core
    Qt6::Test
)

set_project_warnings(uncopener_tests)

add_test(NAME uncopener_tests COMMAND uncopener_tests)
set_tests_properties(uncopener_tests PROPERTIES
    ENVIRONMENT "QT_QPA_PLATFORM=offscreen"
)

# Separate test for resources (needs Qt6::Svg and the resources.qrc)
add_executable(uncopener_resource_tests
    ResourceTests.cpp
    ../src/app/resources.qrc
)

target_link_libraries(uncopener_resource_tests PRIVATE
    Qt6::Core
    Qt6::Gui
    Qt6::Svg
    Qt6::Test
)

set_project_warnings(uncopener_resource_tests)
# Disable clang-tidy for this target (autogenerated qrc files trigger false positives)
target_disable_clang_tidy(uncopener_resource_tests)

add_test(NAME uncopener_resource_tests COMMAND uncopener_resource_tests)
set_tests_properties(uncopener_resource_tests PROPERTIES
    ENVIRONMENT "QT_QPA_PLATFORM=offscreen"
)

# Test for dialog and window icons and MainWindow workflows
add_executable(uncopener_gui_tests
    GuiTestMain.cpp
    DialogTests.cpp
    MainWindowTests.cpp
    ../src/app/ErrorDialog.cpp
    ../src/app/ErrorDialog.hpp
    ../src/app/MainWindow.cpp
    ../src/app/MainWindow.hpp
    ../src/app/AppIcon.cpp
    ../src/app/AppIcon.hpp
    ../src/app/resources.qrc
)

target_include_directories(uncopener_gui_tests PRIVATE
    ../src/app
)

target_link_libraries(uncopener_gui_tests PRIVATE
    uncopener_core
    Qt6::Core
    Qt6::Gui
    Qt6::Svg
    Qt6::Widgets
    Qt6::Test
)

set_project_warnings(uncopener_gui_tests)
# Disable clang-tidy for this target (autogenerated qrc files trigger false positives)
target_disable_clang_tidy(uncopener_gui_tests)

add_test(NAME uncopener_gui_tests COMMAND uncopener_gui_tests)
set_tests_properties(uncopener_gui_tests PROPERTIES
    ENVIRONMENT "QT_QPA_PLATFORM=offscreen"
)
